## 분산 데이터베이스란?

여러 곳에 **분산되어있는 데이터베이스**를 **하나의 데이터베이스 관리 시스템(DBMS, Database Management System)으로 제어**하는 형태의 데이터베이스입니다.

분산되어 있는 데이터베이스는 투명성 확보가 가장 중요한데, 분산 데이터베이스에서는 6가지 투명성을 만족해야 합니다.

| 종류     | 내용                                                                    | 특징                       |
| :------- | ----------------------------------------------------------------------- | -------------------------- |
| 분할     | 물리적 구조가 여러 단편으로 분할 저장되어 논리적으로 사용할 수 있어야함 | 성능 향상                  |
| 위치     | 데이터의 저장 위치를 물리적인 위치가 아닌 논리적 위치로 접근해야함      | 생산성, 활용성 강화        |
| 지역사상 | 개별 지역의 물리적 이름과 관계 없이 접근할 수 있어야함                  | 확장성 확보                |
| 중복     | 데이터를 지역별로 중복 저장해도 데이터 처리가 가능해야함                | 병목현상 해소              |
| 장애     | 장애 발생이 모두 발생하거나 모두 발생하지 않아야 함 (원자성)            | 데이터 일관성              |
| 병행     | 다수의 트랜잭션 수행 시 결과가 일관성있게 유지되어야함                  | 자원처리의 양 및 속도 개선 |

### 분산 데이터베이스의 특징

1. 투명한 분산
   분산 데이터베이스 사용 시 하나의 데이터베이스를 사용하는 것처럼 CRUD 작업을 수행합니다.

2. 투명한 트랜잭션
   각 트랜잭션은 다중 데이터베이스에 걸쳐 일관성을 보장해야 합니다.

### 분산 데이터베이스의 장단점

- 장점

  - **조직 구조 반영 가능** : 기업에서 부서별로 DB를 놓고 각 DB를 통합하여 사용 할 수 있습니다.
  - **부분 자율성** : 각 부서는 자체 보유한 데이터를 제어할 수 있습니다.
  - 중요 데이터 보호 : 재해 발생 시 전체 데이터 손실을 예방할 수 있습니다.
  - **성능 향상** : 자주 사용하는 데이터는 가까이 있고, 전체가 병렬적으로 작동해 DB의 부하 분산이 가능합니다.
  - **경제성** : 거대한 고성능 컴퓨터보다 동일 성능의 소형 컴퓨터 네트워크가 저렴 합니다.
  - **모듈화** : 다른 모듈에 영향을 주지 않고 개별 시스템을 갱신, 추가, 삭제할 수 있습니다.
  - 하나의 사이트에서 장애가 발생해도 전체 기능은 손상되지 않고, **모든 거래는 ACID 특성**에 따릅니다.

- 단점
  - **복잡성** : 투명성 보장을 위해 일반 DB보다 구현이 까다롭고, 각 DB의 하드웨어 종류와 접속이 끊겼을 때의 경우도 고려해야합니다.
  - **비용** : 시스템 규모와 복잡성이 커지면서 관리 비용도 높아집니다.
  - **보안** : 개별 사이트의 보안을 확보하고, 사이트 간 네트워크 보안도 확보해야 전체 보안도 확보할 수 있습니다.
  - **무결성 보장의 어려움** : 분산 DB의 무결성 보장을 위해 상당한 네트워크 자원이 필요합니다.
  - **미성숙한 기술** : 아직 분산 DB분야는 미성숙하고, 실사례가 비교적 적은편입니다.
  - **표준의 부족** : 중앙 DBMS를 분산 DBMS로 변환하기 위한 표준이 없습니다.
  - **데이터베이스 설계의 복잡성** : 일반 DB 설계 이외에 설계 시 고려사항이 늘어납니다.
  - **추가 소프트웨어가 필요**합니다.
  - **운영체제가 분산 컴퓨팅을 지원**해야 합니다.
  - **동시성 제어**가 중요합니다.

### 데이터베이스 분산 기법

- 클러스터링(Clustering)
  데이터베이스 서버가 죽었을 때를 대비하여 서버를 여러 개 두는 방식입니다.
  - Active-Active : 항상 가동 상태로 두는 방식
    ![클러스터_AA](https://github.com/dbdpfls/dbdpfls.github.io/assets/103565462/77001abd-7ac2-4a34-8f35-ffd4cd4f767b))
  - Active-Standby : 일부는 가동하고 일부는 대기하는 상태로 두는 방식
    ![클러스터_AS](https://github.com/dbdpfls/dbdpfls.github.io/assets/103565462/b72899d0-30e0-4e88-b3a8-acc3989af19e)
- 장점

1. 하나의 서버가 죽어도 다른 서버가 역할을 대신 할 수 있어 서비스 중단이 없습니다.
2. 서버가 여러대로 구성되어 있어 성능적으로 유리합니다.

- 단점

1. 데이터베이스는 하나여서 병목현상이 생길 수 있습니다.
2. 여러 대의 서버를 한꺼번에 운영해 많은 비용이 발생합니다.

---

- 레플리케이션(Replication)
  데이터베이스 스토리지가 손상되었을 때를 대비하여 스토리지를 복제하는 방식입니다.

  - 기존 단순 백업 방식

    - Master 데이터베이스에 CRUD가 생기면 Slave 데이터베이스에 전달해 데이터 동기화하는 방식입니다.
    - Master 데이터베이스에 문제 발생 시 Slave 데이터베이스를 Master로 변경하여 사용할 수 있습니다.
      ![레플리케이션_1](https://github.com/dbdpfls/dbdpfls.github.io/assets/103565462/d3ac536b-4fe2-4b3a-b974-4c2bcb1e87ce)

  - 부하 분산 방식 - Slave에서는 Select만 가능한 방식입니다.
    ![레플리케이션_2](https://github.com/dbdpfls/dbdpfls.github.io/assets/103565462/9b55ce5e-93dc-44c8-90cf-46b37bd2c2d8)

- 장점

1. 데이터베이스의 Select 성능을 높일 수 있습니다.
2. 비동기로 운영되어 지연시간이 거의 없습니다.

- 단점

1. Master에 문제가 생기면 복구 및 대처가 어렵습니다.
2. 비동기로 운영되어 데이터 동기화가 보장되지 않아 일관성에 문제가 생길 수 있습니다.

---

- 샤딩
  테이블을 나누어 저장하는 방식입니다.
  ![샤드](https://github.com/dbdpfls/dbdpfls.github.io/assets/103565462/d0f2e12e-ef02-47ad-a56d-6c682ec28fc3)
- Shard key 결정 방식에 따른 샤딩 방법
  - 해시 샤딩
    ![해시샤드](https://github.com/dbdpfls/dbdpfls.github.io/assets/103565462/4cb7b697-a905-4b88-bb90-d15282f9068f)
- 장점

1. 샤드 수만큼 해싱하면 되기 때문에 구현이 간단합니다.

- 단점

1. 샤드 수가 늘어나면 해시 함수가 달라져야 하기 때문에 확장성이 떨어집니다.
2. 해시함수를 통해 나누기 때문에 각 샤드별 공간에 대한 효율을 고려하지 않습니다.

---

    - 다이나믹 샤딩

![다이나믹샤드](https://github.com/dbdpfls/dbdpfls.github.io/assets/103565462/fa0ebd98-36de-412e-a5aa-ec79d83ff21c)

- 장점

1. 샤드가 추가되면 Locator service에 Shard key를 추가하는 방식으로 확장성이 유연합니다.

- 단점

1. 데이터 재배치 시 Locator service 동기화가 필요합니다.
2. Locator service에 의존적이기 때문에 해당 테이블에 문제가 발생하면 DB에도 문제가 전이됩니다.

---

    - 엔티티 그룹 샤딩

![엔티티그룹](https://github.com/dbdpfls/dbdpfls.github.io/assets/103565462/0d71b7af-65c3-437a-abb0-55bfba67ac45)

- 장점

1. 단일 샤드 내 쿼리가 효율적입니다.
2. 단일 샤드 내 응집도가 강합니다.

- 단점

1. 다른 샤드의 엔티티와 연관있는 쿼리는 실행 효율이 떨어집니다.

## 분산원장기술이란?

중앙서버나 중앙 관리자 없이 분산화된 네트워크의 각 노드들이 DB를 공유하고 동기화하는 기술입니다.
분산 원장의 장단점

- 장점

1. **효율성** : 중앙 관리 기관이 필요하지 않아 인력이나 자원 투입을 하지 않아도 되며, 보안사고 방지를 위한 인프라 투자 비용도 절감할 수 있습니다.
2. **보안성** : 중앙 서버가 없어 악의적인 공격으로부터 안전하고 원장이 모든 참가자에게 공개되어 정보 유출 소지가 없습니다.
3. **시스템 안정성** : 단일 실패점(Single Point of Failure)이 존재하지 않아 일부 시스템에 문제가 발생해도 전체 네트워크에 미치는 영향은 미미합니다.
4. **투명성** : 모든 거래기록을 공개하여 높은 투명성을 가지고, 거래 추적이 용이하며 규제 준수 비용도 낮습니다.

- 단점

1. 신뢰를 담보해줄 기관이 없어 시스템 자체에서 신뢰 형성 매커니즘을 설계해야합니다.
2. 특정 내부 참가자가 악의적으로 원장을 조작하여 배포하는 것을 방지해야합니다.
3. 조작 가능성을 차단하면서 원장을 갱신할 수 있는 합의 절차를 마련하지 못해 비트코인 개발 이전까지 동 기술을 실제로 적용하지 못했습니다.

## 블록체인과 분산저장기술의 차이

- 블록체인은 악의적인 사용자가 존재한다는 전제하에 만들어졌으며, **합의 과정을 통해 악의적인 사용자를 방지한다는 점**이 가장 큰 차이점입니다. 또한 블록체인은 **탈중앙화** 되어있어 주로 운영하는 주체가 사라진다고 해도 시스템을 유지할 수 있습니다.
- 블록체인은 분산원장 또는 분산 데이터베이스라고 할 수 있지만 분산 원장 또는 분산 데이터베이스가 블록체인이라고 할 수는 없습니다.
